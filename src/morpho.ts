import * as THREE from "three";
import { instantiateViewer, loadGltf, loadStl, downloadZip, downloadRaw, unzipFile } from "./core";
import { Materials } from "./materials";

const status = document.getElementById("status") as HTMLDivElement;

instantiateViewer(
  document.getElementById("preview") as HTMLCanvasElement,
  async (group: THREE.Group) => {
    status.innerHTML = "モデルをダウンロード中 ...";
    const zip = await downloadZip("./morpho.zip");
    status.innerHTML = "モデルを展開中 ...";

    await Promise.all([
      loadGltf({
        group,
        data: await unzipFile(zip, "left_pcb.glb"),
        pos: [-160, 5 + 1.6, 0],
      }),
      loadGltf({
        group,
        data: await unzipFile(zip, "left_bottom.glb"),
        pos: [-160, 0, 0],
      }),
      loadGltf({
        group,
        data: await unzipFile(zip, "right_pcb.glb"),
        pos: [0, 5 + 1.6, 0],
      }),
      loadGltf({
        group,
        data: await unzipFile(zip, "right_bottom.glb"),
        pos: [0, 0, 0],
      }),
      loadStl({
        group,
        data: await downloadRaw("./1_00u.stl"),
        material: Materials.pbt,
        pos: [
          [19.05 * 0.5, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 1.5, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 2.5, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 3.5, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 4.5, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 5.5, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 6.5, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * -0.25, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 0.75, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 1.75, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 2.75, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 3.75, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 4.75, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 5.75, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 6.75, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 0.5, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 1.5, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 2.5, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 3.5, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 4.5, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 5.5, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 6.5, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 0.5, 5 + 1.6 * 2 + 11.6, 19.05 * 3.5],
          [19.05 * 1.5, 5 + 1.6 * 2 + 11.6, 19.05 * 3.5],
          [19.05 * 2.5, 5 + 1.6 * 2 + 11.6, 19.05 * 3.5],
          [19.05 * 0.5 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 1.5 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 2.5 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 3.5 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 4.5 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 5.5 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * 6.5 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 0.5],
          [19.05 * -0.25 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 0.75 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 1.75 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 2.75 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 3.75 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 4.75 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 5.75 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 6.75 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 1.5],
          [19.05 * 0.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 1.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 2.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 3.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 4.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 5.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 6.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 2.5],
          [19.05 * 4.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 3.5],
          [19.05 * 5.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 3.5],
          [19.05 * 6.0 - 160, 5 + 1.6 * 2 + 11.6, 19.05 * 3.5],
        ],
      }),
      loadStl({
        group,
        data: await downloadRaw("./5mm.stl"),
        material: Materials.stainless,
        pos: [
          [19.05 * -0.5, 1.6, 19.05 * 0.5],
          [19.05 * 7.0, 1.6, 19.05 * 0.5],
          [19.05 * -0.5, 1.6, 19.05 * 2.5],
          [19.05 * 7.0, 1.6, 19.05 * 2.5],
          [19.05 * -0.25, 1.6, 19.05 * 3.5],
          [19.05 * 3.0, 1.6, 19.05 * 3.5],
          [19.05 * -0.5 - 160, 1.6, 19.05 * 0.5],
          [19.05 * 7.0 - 160, 1.6, 19.05 * 0.5],
          [19.05 * -0.5 - 160, 1.6, 19.05 * 2.5],
          [19.05 * 7.0 - 160, 1.6, 19.05 * 2.5],
          [19.05 * 3.5 - 160, 1.6, 19.05 * 3.5],
          [19.05 * 6.75 - 160, 1.6, 19.05 * 3.5],
        ],
      }),
    ]);

    status.remove();
    return;
  },
);

import * as THREE from "three";
import { instantiateViewer, loadGltf, loadStl, downloadZip, downloadRaw, unzipFile } from "./core";
import { Materials } from "./materials";

const status = document.getElementById("status") as HTMLDivElement;

instantiateViewer(
  document.getElementById("preview") as HTMLCanvasElement,
  async (group: THREE.Group) => {
    status.innerHTML = "モデルをダウンロード中 ...";
    const zip = await downloadZip("./gemini.zip");
    status.innerHTML = "モデルを展開中 ...";

    await Promise.all([
      loadGltf({
        group,
        data: await unzipFile(zip, "left_pcb.glb"),
        pos: [0, 7 - 1.6, 19.05 * -4],
      }),
      loadGltf({
        group,
        data: await unzipFile(zip, "right_pcb.glb"),
        pos: [270 - (19.05 * 6.5), 7 - 1.6, 19.05 * -4],
      }),
      loadStl({
        group,
        data: await unzipFile(zip, "plates.stl"),
        material: Materials.acrylic,
        pos: [[0, 0, 0]],
      }),
      loadStl({
        group,
        data: await downloadRaw("./1_00u.stl"),
        material: Materials.pbt,
        pos: [
          [19.05 * 0.5, 18.6, 19.05 * (-3.5 + 13/64 * 3)],
          [19.05 * 1.5, 18.6, 19.05 * (-3.5 + 13/64 * 3)],
          [19.05 * 2.5, 18.6, 19.05 * (-3.5 + 13/64 * 1)],
          [19.05 * 3.5, 18.6, 19.05 * (-3.5 + 13/64 * 0)],
          [19.05 * 4.5, 18.6, 19.05 * (-3.5 + 13/64 * 0)],
          [19.05 * 5.5, 18.6, 19.05 * (-3.5 + 13/64 * 0)],
          [19.05 * 1.75, 18.6, 19.05 * (-2.5 + 13/64 * 3)],
          [19.05 * 2.75, 18.6, 19.05 * (-2.5 + 13/64 * 1)],
          [19.05 * 3.75, 18.6, 19.05 * (-2.5 + 13/64 * 0)],
          [19.05 * 4.75, 18.6, 19.05 * (-2.5 + 13/64 * 0)],
          [19.05 * 5.75, 18.6, 19.05 * (-2.5 + 13/64 * 0)],
          [19.05 * 2.00, 18.6, 19.05 * (-1.5 + 13/64 * 3)],
          [19.05 * 3.00, 18.6, 19.05 * (-1.5 + 13/64 * 1)],
          [19.05 * 4.00, 18.6, 19.05 * (-1.5 + 13/64 * 0)],
          [19.05 * 5.00, 18.6, 19.05 * (-1.5 + 13/64 * 0)],
          [19.05 * 6.00, 18.6, 19.05 * (-1.5 + 13/64 * 0)],
          [19.05 * 1.0 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-3.5 + 13/64 * 0)],
          [19.05 * 2.0 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-3.5 + 13/64 * 0)],
          [19.05 * 3.0 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-3.5 + 13/64 * 0)],
          [19.05 * 4.0 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-3.5 + 13/64 * 1)],
          [19.05 * 5.0 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-3.5 + 13/64 * 3)],
          [19.05 * 6.0 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-3.5 + 13/64 * 3)],
          [19.05 * 0.75 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-2.5 + 13/64 * 0)],
          [19.05 * 1.75 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-2.5 + 13/64 * 0)],
          [19.05 * 2.75 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-2.5 + 13/64 * 0)],
          [19.05 * 3.75 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-2.5 + 13/64 * 1)],
          [19.05 * 4.75 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-2.5 + 13/64 * 3)],
          [19.05 * 0.5 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-1.5 + 13/64 * 0)],
          [19.05 * 1.5 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-1.5 + 13/64 * 0)],
          [19.05 * 2.5 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-1.5 + 13/64 * 0)],
          [19.05 * 3.5 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-1.5 + 13/64 * 1)],
          [19.05 * 4.5 + 270 - (19.05 * 6.5), 18.6, 19.05 * (-1.5 + 13/64 * 3)],
        ],
      }),
      loadStl({
        group,
        data: await downloadRaw("./1_25u.stl"),
        material: Materials.pbt,
        pos: [
          [19.05 * (0.5 + 0.25/2), 18.6, 19.05 * (-2.5 + 13/64 * 3)],
          [19.05 * (4.0 + 0.25/2), 18.6, 19.05 * (-0.5 + 13/64 * 1)],
          [19.05 * (5.75 + 0.25/2) + 270 - (19.05 * 6.5), 18.6, 19.05 * (-2.5 + 13/64 * 3)],
          [19.05 * (2.25 + 0.25/2) + 270 - (19.05 * 6.5), 18.6, 19.05 * (-0.5 + 13/64 * 1)],
        ],
      }),
      loadStl({
        group,
        data: await downloadRaw("./1_50u.stl"),
        material: Materials.pbt,
        pos: [
          [19.05 * (0.5 + 0.5/2), 18.6, 19.05 * (-1.5 + 13/64 * 3)],
          [19.05 * (5.5 + 0.5/2) + 270 - (19.05 * 6.5), 18.6, 19.05 * (-1.5 + 13/64 * 3)],
        ],
      }),
      loadStl({
        group,
        data: await downloadRaw("./1_75u.stl"),
        material: Materials.pbt,
        pos: [
          [19.05 * (5.25 + 0.75/2), 18.6, 19.05 * (-0.5 + 13/64 * 1)],
          [19.05 * (0.5 + 0.75/2) + 270 - (19.05 * 6.5), 18.6, 19.05 * (-0.5 + 13/64 * 1)],
        ],
      }),
      loadStl({
        group,
        data: await unzipFile(zip, "screws.stl"),
        material: Materials.stainless,
        pos: [[0, 0, 0]],
      }),
    ]);

    status.remove();
    return;
  },
);
